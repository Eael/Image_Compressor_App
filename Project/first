from flask import Flask, request, send_from_directory
from PIL import Image
import os

app = Flask(__name__)

UPLOAD_FOLDER = 'uploads/'
RESIZED_FOLDER = 'resized/'

app.config['UPLOAD_FOLDER'] = UPLOAD_FOLDER
app.config['RESIZED_FOLDER'] = RESIZED_FOLDER

def resize_image(image, size, rotate_by):
    image = image.rotate(rotate_by)
    image = image.resize(size)
    return image

@app.route('/upload', methods=['POST'])
def upload_file():
    if 'file' not in request.files:
        return 'No file part'

    file = request.files['file']
    if file.filename == '':
        return 'No selected file'

    if file:
        filename = file.filename
        file.save(os.path.join(app.config['UPLOAD_FOLDER'], filename))
        return 'File uploaded successfully'

@app.route('/resize/<filename>', methods=['GET'])
def resize_and_download(filename):
    upload_path = os.path.join(app.config['UPLOAD_FOLDER'], filename)
    resized_path = os.path.join(app.config['RESIZED_FOLDER'], filename)
    size = (100, 100)  # Change to your desired size
    rotate_by = 90  # Change to your desired rotation angle

    with Image.open(upload_path).convert('RGB') as image:
        resized_image = resize_image(image, size, rotate_by)
        resized_image.save(resized_path)

    return send_from_directory(app.config['RESIZED_FOLDER'], filename, as_attachment=True)

if __name__ == '__main__':
    app.run(debug=True)
